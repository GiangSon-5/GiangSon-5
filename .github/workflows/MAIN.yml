name: Generate Snake

on:
  schedule:
    - cron: "0 */6 * * *"  # ch·∫°y m·ªói 6 gi·ªù
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Install Octopus CLI üêô
      uses: OctopusDeploy/install-octopus-cli-action@v3

    - name: Extract branch name
      shell: bash
      id: extract_branch
      run: echo "branch=$(echo ${GITHUB_REF#refs/heads/})" >> $GITHUB_OUTPUT

    - name: Determine Octopus Deployment Channel
      shell: bash
      id: extract_channel
      run: |
        BRANCH="${{ steps.extract_branch.outputs.branch }}"
        CHANNEL="Features"
        if [[ "$BRANCH" == "main" ]] || [[ "$BRANCH" == "release/*" ]]; then
          CHANNEL="default"
        fi
        echo "channel=$(echo $CHANNEL)" >> $GITHUB_OUTPUT

    - name: Generate Snake SVG üêç
      uses: Platane/snk/svg-only@v3
      with:
        github_user_name: ${{ github.repository_owner }}
        outputs: |
          dist/github-snake.svg
          dist/github-snake-dark.svg?palette=github-dark

    - name: Push Snake to output branch
      uses: crazy-max/ghaction-github-pages@v2.1.3
      with:
        target_branch: output
        build_dir: dist
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
